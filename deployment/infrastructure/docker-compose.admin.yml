# GoChat 管理 & 调试工具
# 可选组件，用于方便地管理和调试核心基础设施

volumes:
  redis-insight-data:
    driver: local

services:
  kafka-ui:
    image: registry.cn-hangzhou.aliyuncs.com/gochat2025/provectuslabs-kafka-ui:latest
    container_name: gochat-kafka-ui
    hostname: kafka-ui
    restart: unless-stopped
    ports:
      - "8088:8080"
    networks:
      - infra-net
      - monitoring-net
    depends_on:
      - kafka1
      - kafka2
      - kafka3
    environment:
      KAFKA_CLUSTERS_0_NAME: gochat-cluster
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka1:9092,kafka2:9092,kafka3:9092

  etcd-workbench:
    image: registry.cn-hangzhou.aliyuncs.com/gochat2025/tzfun-etcd-workbench:latest
    container_name: gochat-etcd-workbench
    hostname: etcd-workbench
    restart: unless-stopped
    ports:
      - "8002:8002"
    networks:
      - infra-net
      - monitoring-net
    depends_on:
      - etcd1
      - etcd2
      - etcd3
    environment:
      ETCD_HOST: etcd1:2379,etcd2:2379,etcd3:2379

  redis-insight:
    image: registry.cn-hangzhou.aliyuncs.com/gochat2025/redis-redisinsight:latest
    container_name: gochat-redis-insight
    hostname: redis-insight
    restart: unless-stopped
    ports:
      - "5540:5540"
    networks:
      - infra-net
      - monitoring-net
    depends_on:
      - redis
    volumes:
      - redis-insight-data:/db

  phpmyadmin:
    image: registry.cn-hangzhou.aliyuncs.com/gochat2025/bitnami-phpmyadmin:latest
    container_name: gochat-phpmyadmin
    hostname: phpmyadmin
    restart: unless-stopped
    environment:
      # === 数据库连接配置 ===
      DATABASE_HOST: mysql                                        # MySQL 服务器主机名
      DATABASE_PORT_NUMBER: 3306                                  # MySQL 端口
      DATABASE_USER: root                                         # 默认登录用户
      DATABASE_PASSWORD: gochat_root_2024                        # 默认登录密码
      
      # === 兼容配置（保持向后兼容）===
      PMA_HOST: mysql                                             # phpMyAdmin 主机配置
      PMA_PORT: 3306                                             # phpMyAdmin 端口配置
      PMA_USER: root                                             # phpMyAdmin 用户配置
      PMA_PASSWORD: gochat_root_2024                             # phpMyAdmin 密码配置
      
      # === 安全配置 ===
      ALLOW_EMPTY_PASSWORD: "no"                                 # 不允许空密码
      
      # === phpMyAdmin 特定配置 ===
      PHPMYADMIN_ALLOW_ARBITRARY_SERVER: "no"                   # 不允许连接任意服务器
      PHPMYADMIN_ALLOW_NO_PASSWORD: "no"                        # 不允许无密码登录
    ports:
      - "8083:8080"  # phpMyAdmin Web 界面 (Bitnami 默认端口 8080)
    networks:
      - infra-net
      - monitoring-net
    depends_on:
      - mysql