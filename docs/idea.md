# 我想给这个系统加上的一些 Idea

## AI 助手

初步可以两种形态提供服务，一种是以会话级别，这种作为一个 Agent，我们可以给它加载所有的聊天信息，采用 RAG 的形式，结合该用户过往所有的聊天记录来作为辅助，同时以 Tools 的方式添加待办、任务工具、发送消息、修改配置等。

第二种形态是群聊小助手，可以智能摘要未读内容，询问群里曾经聊过的内容等。

数据源可以即用数据库来查找也用 RAG 来查找，需要配置到 Chunk，基于时间窗口、且有重叠，设置好Metadata。不要直接索引单条消息。 采用基于时间窗口的会话Chunk作为主策略，为其附加丰富的元数据，并通过异步Worker来构建和更新你的向量索引。这才是处理聊天记录RAG的正解。

## 搜广推技术栈集成

比如用户可能忘记和谁在什么时候聊过什么内容了，可以

技术领域	在IM中的典型应用场景	所需关键技术/知识	难度（学生项目）
搜索技术	聊天记录搜索、文件搜索、联系人搜索	倒排索引、中文分词、 ranking	⭐⭐☆
推荐系统	可能认识的人、加入的群、感兴趣的内容	协同过滤、Embedding、 Graph	⭐⭐⭐⭐

IM系统在消息落库（如MySQL）的同时，将消息内容异步地发送到Elasticsearch中建立索引。当用户在前端搜索时，API直接查询Elasticsearch，快速返回结果和高亮片段。

“可能认识的人”：这是最经典的应用。通过分析用户的好友关系网络（图数据），利用图算法（如Jaccard相似度、Adamic-Adar）或机器学习（如Node2Vec将节点嵌入为向量）来发现共同好友多的人并进行推荐。

“加入的群”：基于群组成员的行为（加入、发言）和群组内容标签，为用户推荐可能感兴趣的群组。可以使用协同过滤（“喜欢这个群的人也喜欢那个群”）或内容过滤（根据用户兴趣标签匹配群组标签）。

## 功能

万人群聊消息风暴、可以采用 im-task 来分批扇出，已有设计
世界聊天室，除了单聊、群聊、AI 聊（todo），还有世界聊天室，大家都在这个聊天室内（前端已做）
高并发连接（ws 多连接，Linux 优化、sync.Pool 优化）
限流（我们处理不过来了，要做不同优先级的限流，例如对大群进行限流降级，投递到 gateway 采用不一样的消息队列 topic 就行了，gateway 优先处理单聊）
确认机制、消息有序性（通过雪花算法 ID，可以粗略认为有序，准备雪花算法时间偏移的解决方案）、消息唯一性（幂等组件、exactly-once）
离线消息处理，消息漫游处理、已读回执（已读、未读消息数、离线消息拉取都要维护当前已读消息的标点，这个标点如何存储呢？仅仅依赖消息队列吗）
系统可观测性建设
对象存储，miniIO，用来存储图片发送、头像设置等
消息路由-负载均衡
一致性与可靠性，数据一致性，用户状态、群成员信息等在多个节点间的一致性问题，是选择强一致性还是最终一致性。
数据冷热分层存储、缓存设计、分表分库
消息时光机（历史消息快速定位和回溯）
系统监控、查看消息量统计、用户活跃度统计、系统性能监控

## im-infra 已经开发完成了

这部分我们可以在 docs 中使用最简短的代码列出来组件提供哪些方法供使用，最简短的，简单的罗列 API 即可
