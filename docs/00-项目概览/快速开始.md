# 快速开始指南

## 环境准备

### 系统要求

- **操作系统**: Linux/macOS/Windows (WSL2)
- **Go 版本**: 1.21+
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **内存**: 建议 8GB+
- **磁盘**: 建议 20GB+

### 安装依赖

#### macOS

```bash
# 安装 Go
brew install go

# 安装 Docker Desktop
brew install --cask docker

# 安装 etcd
brew install etcd

# 安装 Kafka
brew install kafka
```

#### Ubuntu

```bash
# 安装 Go
sudo apt update
sudo apt install -y golang-go

# 安装 Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 安装 Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 安装 etcd
sudo apt install -y etcd

# 安装 Kafka
sudo apt install -y kafka
```

## 项目设置

### 1. 克隆项目

```bash
git clone <repository-url>
cd gochat
```

### 2. 安装开发工具

```bash
make install-tools
```

### 3. 下载依赖

```bash
make deps
```

### 4. 启动开发环境

```bash
make dev
```

这将启动以下服务：
- MySQL (端口 3306)
- Redis (端口 6379)
- Kafka (端口 9092)
- etcd (端口 2379)

### 5. 初始化数据库

```bash
# 创建数据库
mysql -u root -p -e "CREATE DATABASE gochat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 导入初始化脚本
mysql -u root -p gochat < scripts/mysql/init.sql
```

## 开发工作流

### 1. 生成 protobuf 代码

```bash
make proto
```

### 2. 运行测试

```bash
# 运行所有测试
make test

# 运行特定服务测试
make test-service SERVICE=im-gateway
```

### 3. 构建服务

```bash
# 构建所有服务
make build

# 构建特定服务
make build-service SERVICE=im-logic
```

### 4. 运行服务

```bash
# 使用 Docker Compose 运行
docker-compose up -d

# 或者直接运行二进制文件
./bin/im-gateway
./bin/im-logic
./bin/im-repo
./bin/im-task
```

## 代码检查

```bash
# 格式化代码
make fmt

# 检查代码风格
make lint
```

## 常见问题

### 1. 端口冲突

如果遇到端口冲突，可以修改 `docker-compose.yml` 中的端口映射。

### 2. 内存不足

如果遇到内存不足，可以调整 Docker 的内存限制或减少服务实例数。

### 3. 连接问题

确保所有依赖服务都正常启动：
```bash
docker-compose ps
```

### 4. 权限问题

确保有足够的权限运行 Docker：
```bash
sudo usermod -aG docker $USER
```

## 下一步

- 阅读 [架构设计文档](../01-架构设计/README.md)
- 了解 [API 规范](../02-API规范/README.md)
- 查看 [开发指南](../06-开发指南/README.md)